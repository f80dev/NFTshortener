<app-splash
  [appname]="appname"
  [duration]="intro"
  [image]="visual"
  [description]="claim"></app-splash>


<!--tutoriel-->
<app-tuto title="{{appname}} simplifie la distribution automatique de crypto ou de NFT"
          background="https://images.unsplash.com/photo-1499540633125-484965b60031?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2071&q=80"
          [duration]="30" *ngIf="slide==1" (close)="slide=slide+1"></app-tuto>

<app-tuto title="Pour fonctionner, il peut <br><ul><li>utiliser un wallet de test</li><li>créer un wallet dédié</li><li>se servir d'un wallet existant</li></ul>"
          background="https://images.unsplash.com/photo-1512358958014-b651a7ee1773?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80"
          [duration]="30" align="left"
          *ngIf="slide==2" (close)="slide=slide+1"></app-tuto>

<app-tuto title="La distribution se déclenche lorsqu'on ouvre une page web ou un fichier.<br><br>Le visiteur est invité à s'authentifier pour recevoir le contenu à distribuer"
          align="right"
          background="https://images.unsplash.com/photo-1516210938721-0703012a297a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80"
          [duration]="50"
          *ngIf="slide==3" (close)="slide=slide+1"></app-tuto>

<app-hourglass [message]="message" [modal]="true"></app-hourglass>

<div class="background-form" [style.background-image]="'url('+background+')'">
  <div class="popup-form background-component mat-elevation-z18" style="max-width:800px;padding: 2%;" >


    <mat-icon style="color:lightgray;display: block;position: absolute;right:35px;top:5px;opacity: 0.5;cursor: pointer;z-index: 10;"
              (click)="goto_menu()">
      chevron_left
    </mat-icon>

    <mat-icon style="color:lightgray;display: block;position: absolute;right:10px;top:5px;opacity: 0.5;cursor: pointer;z-index: 10;"
              title="Passer en mode avancé pour accèder à des options supplémentaire"
              (click)="switch_mode()">
      person_add
    </mat-icon>

    <div class="titleform" *ngIf="appname">{{title}}</div>

    <div style="width: 100%;text-align: center;" *ngIf="code_to_insert==''">
      <app-input label="Blockchain / Réseau" [options]="networks"
                 style="display: inline-block;"
                 value_type="list" width="200px"
                 [style.pointer-events]="airdrop.dealer_wallet!='' ? 'none' : 'auto'"
                 [value]="network" (valueChange)="update_network($event)"></app-input>
      <br>


      <mat-accordion [multi]="false">
        <!--        <mat-expansion-panel [expanded]="airdrop?.address==''">-->
        <!--          <mat-expansion-panel-header>Désigner le wallet qui va faire la distribution</mat-expansion-panel-header>-->

        <!--          <p *ngIf="airdrop.dealer_wallet!=''">-->
        <!--            Wallet de distribution-->
        <!--            {{airdrop.dealer_wallet | screencutter:"erd..."+airdrop.dealer_wallet.substring(30)}}<br>-->

        <!--            <br><br>-->
        <!--            <app-link [content]="airdrop.dealer_wallet+'/tokens'" [network]="network.value"-->
        <!--                      title="Voir les token" _type="accounts"-->
        <!--                      *ngIf="airdrop.dealer_wallet" icon="travel_explore" style="margin-left: 15px;">-->
        <!--            </app-link>-->
        <!--            <mat-icon (click)="restart()" title="Choisir un autre wallet" style="cursor: pointer;">cancel</mat-icon>-->
        <!--          </p>-->


        <!--          <mat-tab-group style="width: 88%;margin-left:3%;padding: 3%;min-height:200px;"  *ngIf="airdrop.dealer_wallet==''">-->
        <!--            <mat-tab label="Wallet de test" *ngIf="airdrop && airdrop.network!.indexOf('devnet')>-1">-->

        <!--              <br>-->
        <!--              <p>L'usage d'un compte de test est le meilleur moyen de tester totalement gratuitement le système de distribution proposé par {{appname}}</p>-->
        <!--              <br>-->
        <!--              <div style="width: 100%;" class="expansion-content" *ngIf="airdrop.network">-->
        <!--                <app-selkey-->
        <!--                  style="width: 350px;"-->
        <!--                  [with_balance]="false"-->
        <!--                  filter="bob,alice,dudule,carol,franck,eve,dan"-->
        <!--                  [can_see_nfluent_wallet]="false"-->
        <!--                  [can_see_explorer]="false"-->
        <!--                  [can_use_own_key]="false"-->
        <!--                  label="Séletionner un wallet de test"-->
        <!--                  (onChange)="set_public_wallet($event)"-->
        <!--                  [network]="airdrop.network"></app-selkey>-->

        <!--                <div *ngIf="selkey">-->
        <!--                  <div *ngIf="selkey.balance==0">Vous devez transférer quelques eGld sur ce wallet pour pouvoir l'utiliser</div>-->
        <!--                  <button mat-raised-button (click)="use_selkey()" color="primary">-->
        <!--                    Utiliser {{selkey.name}}-->
        <!--                  </button>-->
        <!--                </div>-->



        <!--              </div>-->

        <!--              &lt;!&ndash;						<app-input label="Séletionner un wallet de test"&ndash;&gt;-->
        <!--              &lt;!&ndash;								   value_type="list" width="240px" style="display: inline-block;"&ndash;&gt;-->
        <!--              &lt;!&ndash;								   [options]="public_wallets" (valueChange)="set_public_wallet($event)"></app-input>&ndash;&gt;-->
        <!--              <br>-->
        <!--            </mat-tab>-->

        <!--            <mat-tab label="Wallet dédié">-->
        <!--              <button mat-raised-button-->
        <!--                      *ngIf="message==''"-->
        <!--                      style="margin-top: 30px;" color="primary"-->
        <!--                      title="Créer un wallet pour l'airdrop"-->
        <!--                      (click)="create_account()">-->
        <!--                Créer un wallet dédié-->
        <!--              </button>-->

        <!--              <br>-->
        <!--              <app-tuto [force]="true" [delay]="5" [duration]="100"-->
        <!--                        label="Une fois créé, vous devez transférer au wallet dédié, la monnaie que vous souhaitez distribuer et un egld pour les frais de gaz nécéssaires a la distribution">-->
        <!--              </app-tuto>-->


        <!--            </mat-tab>-->

        <!--            <mat-tab label="Wallet existant">-->
        <!--              <br>-->

        <app-authent *ngIf="airdrop!.dealer_wallet==''"
                     [connexion]="authent"
                     style="max-width: 700px;width: 80%;display: inline-block;"
                     [network]="network.value"
                     [use_cookie]="true"
                     (authent)="on_authent($event)">
        </app-authent>

        <!--              <br>-->
        <!--            </mat-tab>-->
        <!--          </mat-tab-group>-->

        <!--        </mat-expansion-panel>-->

        <mat-expansion-panel *ngIf="airdrop.dealer_wallet!=''" [expanded]="show_token">
          <mat-expansion-panel-header>
            <span *ngIf="!airdrop.token.hasOwnProperty('identifier')">Que va t'on distribuer ?</span>
            <span *ngIf="airdrop.token.hasOwnProperty('identifier')">Airdrop de {{airdrop.token.name}}</span>
          </mat-expansion-panel-header>


          <mat-tab-group style="width: 100%;">
            <mat-tab label="Choisissez une monnaie à distribuer">
              <div *ngIf="qrcode_wallet.length>0 && !airdrop.token.id" style="width: 100%;text-align: center;margin-top: 20px;">

                <div class="mat-body-2">Envoyer la monnaie à distribuer et un peu d'eGld pour les frais de gaz sur votre nouveau wallet</div><br>
                <img [src]="qrcode_wallet" title="Cliquer pour copier l'adresse de réception"
                     style="width: 150px;margin:10px;cursor: copy;" [cdkCopyToClipboard]="airdrop.dealer_wallet"><br>
                <button mat-raised-button (click)="qrcode_wallet=''">Annuler</button>
              </div>

              <br>
              <app-token-selector
                                  [owner]="owner_filter"
                                  [canChangeFilter]="false"
                                  [canCreateMoney]="true"
                                  style="width: 92%;display: inline-block;"
                                  [network]="airdrop.network"
                                  [show_detail]="false"
                                  (endSearch)="onEndSearch($event)"
                                  (valueChange)="select_token($event)"
                                  (unselect)="airdrop!.token={}"
              ></app-token-selector>
            </mat-tab>
            <mat-tab label="Distribuer des NFTs">
              <div *ngIf="qrcode_wallet.length>0" style="width: 100%;text-align: center;margin-top: 20px;">
                <div class="mat-body-2">Envoyer des NFTs à distribuer et un peu d'eGld pour les frais de gaz sur votre nouveau wallet</div><br>
                <img [src]="qrcode_wallet" title="Cliquer pour copier l'adresse de réception"
                     style="width: 150px;margin:10px;cursor: copy;" [cdkCopyToClipboard]="airdrop.dealer_wallet"><br>
                <button mat-raised-button (click)="cancel()">Annuler</button>
              </div>

              <br>
              <!--              <div *ngIf="collections.length==0" style="margin-top: 20px;">Vous n'avez aucun NFT à distribuer sur le wallet sélectionné</div>-->

              <h4>Fonctionnalité bientôt disponible</h4>

<!--              <app-collection-selector [network]="airdrop.network"-->
<!--                                       [owner]="owner_filter"-->
<!--                                       (endSearch)="onEndSearchCollection($event)"-->
<!--                                       [query]="query_collection"-->
<!--                                       w_image="100px" w_image_selected="200px"-->
<!--                                       [min_supply]="1"-->
<!--                                       title="Sélectionner la collection à distribuer"-->
<!--                                       (selected)="select_collection($event)">-->
<!--              </app-collection-selector>-->
              <br><br><br>

              <button mat-raised-button
                      (click)="start_with_collection()"
                      *ngIf="collection && !airdrop.collection">
                Utiliser cette collection
              </button>

              <button mat-raised-button
                      (click)="collection=emptyCollection();airdrop.collection=undefined"
                      *ngIf="collection">
                Changer de collection
              </button>

            </mat-tab>
          </mat-tab-group>

        </mat-expansion-panel>

        <div *ngIf="airdrop!.token! && (airdrop!.token.identifier || airdrop!.collection)">
          <mat-expansion-panel  [expanded]="show_quantity"  [expanded]="true">
            <mat-expansion-panel-header>Type d'airdrop</mat-expansion-panel-header>

            <mat-tab-group>
              <mat-tab label="Open AirDrop">
                <p class="explain-bloc">Airdrop ouvert à tous tant qu'il reste quelque chose à distributer</p>

                <app-input label="Montant aloué à l'airdrop" width="300px" style="display: inline-block;"
                           [value]="to_send_airdrop" [min]="0" [max]="balance"
                           [unity]="airdrop.unity"
                           (valueChange)="update_total($event)"
                           value_type="number"></app-input>

              </mat-tab>
              <mat-tab label="Airdrop fermé">
                <p class="explain-bloc" *ngIf="airdrop.claimers!.length==0">Seule une liste limitée d'adresses peut revevoir l'airdrop</p>
                <div *ngIf="airdrop.claimers.length==0">
                  <app-upload-file extensions=".csv,.xls"
                                   title="Charger le fichier contenant les adresses"
                                   [zone]="true"
                                   width="100%"
                                   height="80px"
                                   (uploaded)="upload_addresses($event)">
                    Fichier d'adresses éligibles
                  </app-upload-file>

                  <br>

                  <app-input value_type="memo" [value]="claimer_addresses"
                             style="width:350px;display:inline-block;"
                             [rows]="5"
                             (valueChange)="upload_addresses({file:$event})"
                             label="Coller ici la liste des adresses"></app-input>
                </div>


                <div *ngIf="airdrop.claimers.length>0" >

                  <br>

                  {{airdrop.claimers.length}} adresses sont éligibles

                  <app-input value_type="boolean" [value]="show_addresses"
                             style="display: inline-block;"
                             (valueChange)="show_addresses=$event"
                             label="Voir les adresses"></app-input>

                  <br><br>

                  <button mat-raised-button
                          (click)="airdrop.claimers=[]"
                          *ngIf="airdrop!.token.identifier || airdrop!.collection">
                    Effacer les adresses
                  </button>
                  <br><br>


                  <div *ngIf="show_addresses" style="width: 100%;overflow: scroll;">
                    <div *ngFor="let r of airdrop.claimers">{{r}}</div>
                  </div>

                </div>
              </mat-tab>
            </mat-tab-group>
          </mat-expansion-panel>



<!--          -->

          <mat-expansion-panel>
            <mat-expansion-panel-header>Montant & Période</mat-expansion-panel-header>

            <h5>Montant total + frais de service ({{airdrop.marge}}%)</h5>
            <h3 style="margin-top: -10px;">{{airdrop.total}} {{airdrop.token.name}}</h3>


            <div style="width: 100%;display: flex;flex-wrap: wrap;align-items: center;justify-content:space-around;margin-left: -5px;margin-top:40px;">

              <app-tuto *ngIf="airdrop!.token.identifier" [force]="true"
                        label="Vous maitrisez le montant du versement à chaque visite ainsi que la quantité maximum / jour et la limite par wallet au-delà de laquelle le versement n'a plus lieu"></app-tuto>


              <app-input label="Montant versé à chaque demande" width="300px" style="display: inline-block;"
                         [value]="airdrop.amount" [min]="0" [max]="airdrop.limit_by_day"
                         [unity]="airdrop.unity"
                         (valueChange)="airdrop.amount=$event"
                         value_type="number"></app-input>


              <!--            <app-input label="Rechargement maximum / jour" width="300px%"  style="display: inline-block;"-->
              <!--                       [value]="airdrop.limit_by_day" [min]="0"-->
              <!--                       [unity]="airdrop.unity"-->
              <!--                       (valueChange)="airdrop.limit_by_day=$event"-->
              <!--                       value_type="number"></app-input>-->

              <app-input label="Limite par wallet" width="300px%"  style="display: inline-block;"
                         help="Au delà de ce montant par wallet, le rechargement n'a plus lieu"
                         [value]="airdrop.limit_by_wallet" [min]="0"
                         [unity]="airdrop.unity"
                         (valueChange)="airdrop.limit_by_wallet=$event"
                         value_type="number"></app-input>
            </div>

            <app-input label="Période de l'airdrop" style="display: inline-block;"
                       [value]="start_date"
                       (valueChange)="range=$event"
                       value_type="daterange"></app-input>

            <app-input label="Heure de début" style="display: inline-block;"
                       [value]="hour"
                       (valueChange)="hour=$event"
                       value_type="time"></app-input>




          </mat-expansion-panel>

          <mat-expansion-panel *ngIf="airdrop!.token! && airdrop!.token.identifier || airdrop!.collection" [expanded]="false">
            <mat-expansion-panel-header>Process d'authentification</mat-expansion-panel-header>
            <app-input value_type="boolean" [value]="airdrop.force_authent"
                       help="Dans le cas contraire, l'adresse de l'utilisateur est enregistré sous forme de cookie donc demander à la première visite uniquement"
                       (valueChange)="update_authent($event)"
                       label="Forcer l'authentification avant chaque versement"></app-input>
            <br>

            <p style="text-align: left;" class="mat-body-1">
              L'authentification est possible via :<br>
              <app-input label="Wallet connect" [value]="connexion.wallet_connect" (valueChange)="connexion.wallet_connect=$event" value_type="boolean"></app-input>
              <app-input label="Extension Chrome" [value]="connexion.extension_wallet" (valueChange)="connexion.extension_wallet=$event" value_type="boolean"></app-input>
              <app-input label="Email / Google (entrainant une création de wallet)" [value]="connexion.email" (valueChange)="connexion.email=$event" value_type="boolean"></app-input>

            </p>

          </mat-expansion-panel>
        </div>

      </mat-accordion>




      <!--			<div *ngIf="airdrop.dealer_wallet==''" class="expansion-content-left" style="width:350px;">-->
      <!--				<br>-->
      <!--					<app-upload-file style="margin-top:-16px;" [zone]="true"-->
      <!--					                 extensions=".json" (uploaded)="keystore_upload($event)"-->
      <!--					                 height="50px" icon="file_upload"></app-upload-file>-->


      <!--					<button mat-icon-button-->
      <!--					        [disabled]="airdrop.dealer_wallet!=''"-->
      <!--					        style="margin-top: -10px;"-->
      <!--					        title="Utiliser un wallet existant"-->
      <!--					        (click)="encrypt_key()">-->
      <!--						<mat-icon>key</mat-icon>-->
      <!--					</button>-->
      <!--			</div>-->




      <button mat-raised-button color="primary"
              (click)="save_airdrop()"
              *ngIf="airdrop!.token.identifier || airdrop!.collection">
        Suivant
      </button>

    </div>

    <app-tuto [force]="true" *ngIf="code_to_insert!=''" icon=""
              label="Il existe plusieurs facons de déclencher l'airdrop que vous venez de préparer"></app-tuto>

    <mat-tab-group *ngIf="code_to_insert!=''" style="text-align: center;width:100%;margin-left: -10px;" >
      <mat-tab label="Affiliation" *ngIf="false" >

        <br>
        <app-input label="Votre lien à proposer" [value]="affiliate_url" (valueChange)="affiliate_url=$event"
                   maxwidth="400px"
                   value_type="text"></app-input>
        <br>

        <button mat-raised-button (click)="add_affiliate_link()">Ajouter</button>
      </mat-tab>


      <mat-tab label="Lien récompensé">
        <p class="explain-bloc">
          Récompenser les personnes visitant le lien {{redirect}}
        </p>
        <br>
        <div *ngIf="short_url.length==0" style="width:90%;max-width: 600px;display: inline-block;">
          <app-input label="Rediriger vers" value_type="text"
                     help="Adresse du site web vers lequel le visiteur est dirigé"
                     [value]="redirect" (valueChange)="redirect=$event;"></app-input>

          <br>
          <button mat-raised-button (click)="eval_redirect()"
                  [disabled]="redirect==''"
                  title="Fabrique le lien court à partager pour activer l'airdrop"
                  color="primary">Créer le lien de redirection</button>

          <br><br>

          <mat-expansion-panel style="max-width: 500px;display: inline-block;">
            <mat-expansion-panel-header>Options avancées</mat-expansion-panel-header>
            <br>
            <app-input label="Message pour la redirection" value_type="text"
                       [value]="redirect_message" (valueChange)="redirect_message=$event;"></app-input>
            <br>
            <app-input label="Pourcentage de visites récompensées" unity="%" width="350px"
                       help="Pour 100 visites, seule une partie obtient la récompense"
                       [value]="airdrop.random" [min]="1" [max]="100" value_type="slide"
                       (valueChange)="airdrop.random=$event;">
            </app-input>
            <br>

            <div class="expansion-content-left" style="margin-top: -20px;">
              <app-input label="Image de fond de l'écran d'acceuil" style="width:75%;margin-right: 10px;"
                         [value]="background_image" (valueChange)="background_image=$event"
                         help="Cette image sera affiché comme fond d'écran"></app-input>

              <button mat-raised-button (click)="find_images()">Banques d'images</button>

            </div>
          </mat-expansion-panel>

        </div>


        <div *ngIf="short_url.length>0">
          {{short_url}}<br><br>

          <img [src]="url_qrcode" style="width: 150px;height:150px;">
          <br><br>
          <button mat-raised-button (click)="share_url(short_url)">Partager</button>
          <button mat-raised-button (click)="open_test(short_url)">Tester</button>
          <button mat-raised-button (click)="modify()">Modifier</button>
        </div>
      </mat-tab>

      <mat-tab label="Lien direct (Faucet)" style="text-align: center;" >

        <div *ngIf="url_bank!=''">
          <br><br>
          <app-link [content]="airdrop.redirect">
            Lien pour l'airdrop de {{airdrop.token.name}}<br>
          </app-link>
          <br><br>
          <button mat-raised-button (click)="share_url(airdrop.redirect)">Partager</button>
          <button mat-raised-button (click)="open_test(airdrop.redirect)">Tester</button>
          <br><br>
          <app-genlink [properties]="link_properties"
                       style="max-width: 500px;display: inline-block;"
                       [show_command_panel]="false"
                       title="Personnaliser l'aspect de la banque"
                       (update)="update_properties($event)">

            <app-input label="Adresse web de la banque" width="350px" style="display: inline-block;"
                       *ngIf="user.advance_mode"
                       [value]="url_bank" (valueChange)="url_bank=$event"></app-input>

          </app-genlink>

        </div>

      </mat-tab>

      <mat-tab label="Visiteurs">
        <div style="width: 100%;text-align: center;">
          <p class="explain-bloc">
            Insérer le code suivant dans votre page pour que chaque visiteur recoive à chaque ouverture {{airdrop.amount}}
            dans la limite de {{airdrop.limit_by_wallet}}
          </p>


          <mat-expansion-panel style="max-width: 500px;display: inline-block;">
            <mat-expansion-panel-header>Options avancées</mat-expansion-panel-header>
            <br>
            <app-input label="Pourcentage de visites récompensées" unity="%" width="350px"
                       help="Pour 100 visites, seule une partie obtient la récompense"
                       [value]="airdrop.random" [min]="1" [max]="100" value_type="slide"
                       (valueChange)="airdrop.random=$event;">
            </app-input>

            <app-input label="Delai avant versement" unity="sec" width="350px"
                       help="Si le visiteur quitte trop top la page il n'est pas récompensé"
                       [value]="airdrop.authent_delay" [min]="0" [max]="60" value_type="slide"
                       (valueChange)="airdrop.authent_delay=$event;">
            </app-input>

            <div class="expansion-content-left" *ngIf="user.advance_mode" style="width: 100%;">
              <app-input label="Date de début de campagne" value_type="text" width="180px"
                         [value]="airdrop.dtStart" (valueChange)="airdrop.dtStart=$event;save_airdrop()"></app-input>

              <app-input label="Date de fin" value_type="text" width="180px"
                         [value]="airdrop.dtEnd" (valueChange)="airdrop.dtEnd=$event"></app-input>

            </div>


            <app-input label="Informer le visiteur du versement" value_type="boolean"
                       [value]="airdrop.show_deal" (valueChange)="airdrop.show_deal=$event;save_airdrop()"></app-input>


            <br>

          </mat-expansion-panel>

          <div class="mat-elevation-z4 mat-body-2"  [cdkCopyToClipboard]="code_to_insert"
               title="Cliquer pour copier le contenu"
               style="cursor: copy;padding:5px;max-height:30vh;max-width:550px;width:87%;display: inline-block;margin: 10px;text-align: left;opacity: 0.4;overflow: hidden;">
            {{code_to_insert}}
          </div>
        </div>
      </mat-tab>

    </mat-tab-group>

    <div style="width:100%;text-align: center;position: absolute;bottom:10px;" *ngIf="code_to_insert!=''">
      <button mat-raised-button
              (click)="code_to_insert=''">Modifier</button>

      <button mat-raised-button
              (click)="restart()">Annuler</button>

    </div>

  </div>

</div>
